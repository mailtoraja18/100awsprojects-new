<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Experiment with SAM Local | AWS Projects</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/www.100awsprojects.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/www.100awsprojects.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/www.100awsprojects.com/favicon-16x16.png">
    <link rel="manifest" href="/www.100awsprojects.com/manifest.json">
    <link rel="mask-icon" href="/www.100awsprojects.com/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="/www.100awsprojects.com/css/main.scss"/>

    
    
    

    
    
 
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'Your Google Analytics tracking id', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>

    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/www.100awsprojects.com/">AWS Projects</a>
    </div>  
</header>

  <div class="nav-menu">
  
    <a class="color-link nav-link" href="/www.100awsprojects.com/">Posts</a>
  
    <a class="color-link nav-link" href="/www.100awsprojects.com/about">About</a>
  
    <a class="color-link nav-link" href="/www.100awsprojects.com/tags">Tags</a>
  
  <a class="color-link nav-link" href="www.100awsprojects.com/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="Your%20Twitter%20username" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="Your%20GitHub%20username" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

    

</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="/www.100awsprojects.com/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww=" crossorigin="anonymous"></script>
</footer>
</nav>

        <div id="content" class="content-container">
        

<h1 class="post-title">Experiment with SAM Local</h1>
    
    <time>March 21, 2018</time>
    
    <div>
        <p>
        <!-- raw HTML omitted -->
<p>The goal of AWS SAM is to define a standard application model for serverless applications. With AWS SAM Local you can be used to test functions LOCALLY in your desktop, start a LOCAL API Gateway from a SAM template, validate a SAM template, and generate sample payloads for various event sources. Lets get started to see some SAM Local in action. After testing locally you can package and deploy the functions to remote.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Go through the url and setup the Prerequisites. <a href="https://github.com/awslabs/aws-sam-local">https://github.com/awslabs/aws-sam-local</a>
<ul>
<li>Install NodeJs</li>
<li>Install Docker CE (Windows or Mac) , start Docker</li>
<li>Execute command <code>npm install -g aws-sam-local</code> to install aws sam local</li>
</ul>
</li>
<li>In Windows you might need to do the following for Docker.
<ul>
<li>set HOME=C:\Users\user</li>
<li>provide access to your C drive to docker</li>
</ul>
</li>
<li>Install Dynamo DB Locally and Start
<ul>
<li><a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html">https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DynamoDBLocal.html</a>)</li>
</ul>
</li>
<li>Start Docker Container
<ul>
<li>use <code>Docker for Windows</code>s shortcut</li>
</ul>
</li>
<li>Install Postman for testing, <a href="https://app.getpostman.com/app/download/win64">https://app.getpostman.com/app/download/win64</a> , for Mac you can use curl.</li>
</ul>
<h2 id="a-note-about-aws-config-update-endpoint">A Note about AWS Config Update Endpoint</h2>
<p>This endpoint helps you point to the Local Dynamo DB. Be mindful wether your code is pointing locally or remote.</p>
<pre><code>AWS.config.update({
     region: &quot;us-east-1&quot;,
     endpoint: &quot;http://&lt;what to put here ?&gt;:8000&quot;
 }); 
</code></pre><h3 id="in-windows">In Windows</h3>
<p>In Docker for Windows, the container communicates through a vEthernet adapter called DockerNAT. To find its details, open Command Prompt and type <code>ipconfig</code>
Look for an entry that looks like</p>
<p>Ethernet adapter vEthernet (DockerNAT):</p>
<pre><code>Connection-specific DNS Suffix  . :
Link-local IPv6 Address . . . . . : fe80::fd29:297:4583:3ad4%4
IPv4 Address. . . . . . . . . . . : 10.0.75.1
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Gateway . . . . . . . . . :
</code></pre><p>The IP address to the right of IPv4 Address is the one you need.</p>
<h3 id="for-mac">For MAC</h3>
<p>use this <code>docker.for.mac.localhost</code></p>
<h2 id="code-resources-and-next">Code Resources and Next</h2>
<h3 id="1-download-and-review-code">1) Download and Review Code</h3>
<p>Download the petclinic_sam folder <a href="https://github.com/mailtoraja18/aws_serverless_resources/tree/master/petclinic_sam">https://github.com/mailtoraja18/aws_serverless_resources/tree/master/petclinic_sam</a></p>
<h3 id="2-start-dynamodb-locally-and-create-pet-table">2) Start Dynamodb Locally and Create Pet table</h3>
<ul>
<li>Run <code>java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -sharedDb</code></li>
<li>Run <code>node dynamo_pet_create_table.js</code></li>
</ul>
<h3 id="3-load-data">3) Load data</h3>
<ul>
<li>Run <code>node dynamo_pet_load_data.js</code></li>
</ul>
<h3 id="4-start-the-sam-local-from-petclinic_sam-folder">4) Start the SAM-LOCAL from petclinic_sam folder</h3>
<p><code>sam --version</code> and then <code>sam local start-api</code></p>
<p>First time</p>
<pre><code>2018/03/21 18:52:35 Connected to Docker 1.35
2018/03/21 18:52:35 Runtime image missing, will pull....
2018/03/21 18:52:35 Fetching lambci/lambda:nodejs6.10 image for nodejs6.10 runtime...
nodejs6.10: Pulling from lambci/lambda
5be106c3813f: Extracting  192.2MB/324.7MB
e240967675e1: Download complete
95d21be37ff9: Download complete
caf7e45f0ace: Download complete
</code></pre><p>You should see the below log next time onwards</p>
<pre><code>2018/03/23 21:42:29 Fetching lambci/lambda:nodejs6.10 image for nodejs6.10 runtime...
nodejs6.10: Pulling from lambci/lambda
Digest: sha256:bc47c223a2accf47c51adc6e1949bda9b557764be38a76ebac73e545044079cc
Status: Image is up to date for lambci/lambda:nodejs6.10
</code></pre><p>Then you should see the REST API&rsquo;s deployed (i dont know why it shows the same file for all , bug ?)</p>
<pre><code>Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets [POST]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/info [POST]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/status [POST]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets [DELETE]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/{petId} [GET]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets [GET]
Mounting dynamo_pet_find_by_status.handler (nodejs6.10) at http://127.0.0.1:3000/pets/status/{status} [GET]
</code></pre><h2 id="test-locally-using-postman">Test Locally using Postman</h2>
<p>Use postman to fire away at the REST API&rsquo;s. After you have tested , its time to deploy remotely.</p>
<h2 id="what-just-happened-">What just happened ?</h2>
<p>The template.yaml provides the API definitions and the scripts they should point at. We are running the DynamoDB locally here . On AWS you would use 
the dynamo db access policy <code>Policies: AmazonDynamoDBFullAccess</code> to access the DynamoDB. The below package and deploy commands will push all teh code to S3 bucket and use clould formation to create 
the API Gateway and Lambda function and apply the policy.</p>
<h2 id="deploy-remote">Deploy Remote</h2>
<ul>
<li>create a new bucket like <code>xdr56yhn-aws-sam</code> in your account.</li>
<li><code>sam package --template-file template.yaml --s3-bucket xdr56yhn-aws-sam --output-template-file packaged.yaml</code></li>
<li><code>sam deploy --template-file ./packaged.yaml --stack-name PetStack --capabilities CAPABILITY_IAM</code></li>
</ul>
<h2 id="test-remote">Test Remote</h2>
<p>Pull up the AWS API Gateway page and use the Console Test functionality to test the functions.</p>
<h2 id="delete-stack">Delete Stack</h2>
<p>You just created a AWS Cloudformation Stack. You can get into the page and choose Action &gt; Delete to delete the stact you just created.</p>

        </p>
    </div>
    

    

    <div class="page-footer">
        
    </div>


        
        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="Your%20Twitter%20username" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="Your%20GitHub%20username" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    

    

    

    

    

</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="/www.100awsprojects.com/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww=" crossorigin="anonymous"></script>
</footer>
    </body>
</html>